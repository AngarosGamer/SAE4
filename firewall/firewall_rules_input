#!/usr/sbin/nft -f

# Script pour le routeur d'IP 192.168.128.1/17, dans le sous-réseau de l'intranet
# Se charge de diriger le traffic entre les postes de travail et les serveurs différents

# Règles serveur Kerberos
add rule filter input udp dport 88 ip daddr 192.168.128.8 ip saddr 192.168.0.0/32 ct state new accept
add rule filter input tcp dport 88 ip daddr 192.168.128.8 ip saddr 192.168.0.0/32 ct state new accept
add rule filter input udp dport 88 ip daddr 192.168.0.0/32 ip saddr 192.168.128.8 ct state new accept

# Règles serveur DHCP
add rule filter input udp dport 67 ip daddr 192.168.128.7 ip saddr 192.168.128.0/17 ct state new accept
add rule filter input tcp dport 68 ip daddr 192.168.128.7 ip saddr 192.168.128.0/17 ct state new accept 

# Règles serveur LDAP
add rule filter input tcp dport 636 ip daddr 192.168.128.6 ip saddr 192.168.0.0/32 ct state new accept

# Règles serveur DNS
add rule filter intput udp sport 53 ip daddr 192.168.128.5 ip saddr 192.168.0.0/32 ct state new accept

# Règles serveur de fichiers
add rule filter input tcp dport 2049 ip daddr 192.168.128.4 ip saddr 192.168.128.0/17 ct state new accept

# Règles serveur de log
add rule filter input tcp dport 19532 ip daddr 192.168.128.3 ip saddr 192.168.0.0/32 ct state new accept
add rule filter input tcp dport 80 ip daddr 192.168.128.3 ip saddr 192.168.0.0/32 ct state new accept

# Règles serveur postgres
add rule filter input tcp dport 5432 ip daddr 192.168.128.2 ip saddr 192.168.128.0/17 ct state new accept

add rule filter input ct state established accept # Accepter les connexions établies par défaut

add rule filter input drop # refuser toutes les connexions ne répondant pas aux critères précédents